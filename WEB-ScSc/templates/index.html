{% extends 'base.html' %}

{% block content %}
<!-- Teachers Tab -->
<div class="tab-pane fade show active" id="teachers" role="tabpanel">
    <div class="p-3">
        <div class="btn-group mb-3" role="group">
            <button class="btn btn-primary" onclick="addTeacher()">{{ _(0) }}</button>
            <button class="btn btn-secondary" onclick="editTeacher()">{{ _(16) }}</button>
            <button class="btn btn-danger" onclick="deleteTeacher()">{{ _(17) }}</button>
            <button class="btn btn-outline-secondary" onclick="moveTeacher('up')">{{ _(18) }}</button>
            <button class="btn btn-outline-secondary" onclick="moveTeacher('down')">{{ _(19) }}</button>
        </div>
        
        <div class="table-responsive" style="max-height: 500px; overflow-y: auto;">
            <table id="teachersTable" class="table table-striped table-hover">
                <thead class="sticky-top bg-white">
                    <tr>
                        <th>{{ _(10) }}</th>
                        <th>{{ _(11) }}</th>
                        <th>{{ _(14) }}</th>
                        <th class="text-end">{{ _(101) }}</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- Populated by JavaScript -->
                </tbody>
            </table>
        </div>
    </div>
</div>

<!-- Groups Tab -->
<div class="tab-pane fade" id="groups" role="tabpanel">
    <div class="p-3">
        <div class="btn-group mb-3" role="group">
            <button class="btn btn-primary" onclick="addGroup()">{{ _(1) }}</button>
            <button class="btn btn-secondary" onclick="editGroup()">{{ _(16) }}</button>
            <button class="btn btn-danger" onclick="deleteGroup()">{{ _(17) }}</button>
            <button class="btn btn-outline-secondary" onclick="moveGroup('up')">{{ _('Move Up ‚Üë') }}</button>
            <button class="btn btn-outline-secondary" onclick="moveGroup('down')">{{ _('Move Down ‚Üì') }}</button>
        </div>
        
        <div class="table-responsive" style="max-height: 500px; overflow-y: auto;">
            <table id="groupsTable" class="table table-striped table-hover">
                <thead class="sticky-top bg-white">
                    <tr>
                        <th>{{ _(10) }}</th>
                        <th>{{ _('Comments') }}</th>
                        <th>{{ _('Total Required / Assigned') }}</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- Populated by JavaScript -->
                </tbody>
            </table>
        </div>
    </div>
</div>

<!-- Subjects Tab -->
<div class="tab-pane fade" id="subjects" role="tabpanel">
    <div class="p-3">
        <div class="btn-group mb-3" role="group">
            <button class="btn btn-primary" onclick="addSubject()">{{ _(2) }}</button>
            <button class="btn btn-secondary" onclick="editSubject()">{{ _(16) }}</button>
            <button class="btn btn-danger" onclick="deleteSubject()">{{ _(17) }}</button>
            <button class="btn btn-outline-secondary" onclick="moveSubject('up')">{{ _('Move Up ‚Üë') }}</button>
            <button class="btn btn-outline-secondary" onclick="moveSubject('down')">{{ _('Move Down ‚Üì') }}</button>
        </div>
        
        <div class="table-responsive" style="max-height: 500px; overflow-y: auto;">
            <table id="subjectsTable" class="table table-striped table-hover">
                <thead class="sticky-top bg-white">
                    <tr>
                        <th>{{ _(10) }}</th>
                        <th>{{ _(13) }}</th>
                        <th>{{ _(31) }}</th>
                        <th>{{ _(3) }}</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- Populated by JavaScript -->
                </tbody>
            </table>
        </div>
    </div>
</div>

<!-- Group Scheduler Tab -->
<div class="tab-pane fade" id="group-scheduler" role="tabpanel">
    <div class="p-3">
        <div class="control-panel mb-3">
            <label>{{ _(32) }}</label>
            <select id="groupSelect" class="form-select" style="width:300px; display:inline-block; margin: 0 10px;">
                <!-- Populated by JS -->
            </select>
            <button class="btn btn-success" onclick="autofillGroup()">{{ _(34) }}</button>
            <button class="btn btn-warning" onclick="clearGroupSchedule()">{{ _(35) }}</button>
        </div>
        
        <div id="groupScheduleGrid" class="schedule-grid">
            <!-- Generated by JavaScript -->
        </div>
    </div>
</div>

<!-- Teacher Scheduler Tab -->
<div class="tab-pane fade" id="teacher-scheduler" role="tabpanel">
    <div class="p-3">
        <div class="control-panel mb-3">
            <label>{{ _(33) }}</label>
            <select id="teacherSelect" class="form-select" style="width:300px; display:inline-block; margin: 0 10px;">
                <!-- Populated by JS -->
            </select>
        </div>
        
        <div id="teacherScheduleGrid" class="schedule-grid">
            <!-- Generated by JavaScript -->
        </div>
    </div>
</div>

<!-- Day Scheduler Tab -->
<div class="tab-pane fade" id="day-scheduler" role="tabpanel">
    <div class="p-3">
        <div class="control-panel mb-3">
            <label>{{ _('Select Weekday') }}</label>
            <select id="weekdaySelect" class="form-select" style="width:300px; display:inline-block; margin: 0 10px;">
                <!-- Populated by JS -->
            </select>
        </div>

        <div id="daySchedulerGrid" class="d-flex flex-column gap-3">
            <!-- Per-group schedule panels inserted by JS -->
        </div>
    </div>
</div>

<!-- Configuration Tab -->
<div class="tab-pane fade" id="configuration" role="tabpanel">
    <div class="p-3">
        <form id="configForm">
            <div class="row">
                <div class="col-md-4">
                    <h5>{{ _(52) }}</h5>
                    <div class="mb-3">
                        <label class="form-label">{{ _(52) }}</label>
                        <select class="form-select" name="GUI_LANGUAGE">
                            <option value="English">{{ _(61) }}</option>
                            <option value="◊¢◊ë◊®◊ô◊™">{{ _(62) }}</option>
                            <option value="–†—É—Å—Å–∫–∏–π">{{ _(63) }}</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">{{ _(53) }}</label>
                        <input type="text" class="form-control" name="app_name" value="{{ _('School Scheduler') }}">
                    </div>
                </div>
                
                <div class="col-md-4">
                    <h5>{{ _(55) }}</h5>
                    <div class="mb-3">
                        <label class="form-label">{{ _(55) }}</label>
                        <select class="form-select" name="autofill_direction">
                            <option value="forward">{{ _(64) }}</option>
                            <option value="backward">{{ _(65) }}</option>
                            <option value="random">{{ _(66) }}</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">{{ _(56) }}</label>
                        <input type="number" class="form-control" name="max_autofill_retries" value="100">
                    </div>
                    <div class="mb-3">
                        <label class="form-label">{{ _(57) }}</label>
                        <input type="number" class="form-control" name="max_sequence_lessons" value="2">
                    </div>
                    <div class="mb-3">
                        <label class="form-label">{{ _(58) }}</label>
                        <input type="number" class="form-control" name="max_per_day" value="3">
                    </div>
                </div>
                
                <div class="col-md-4">
                    <h5>{{ _(74) }}</h5>
                    <div class="mb-3">
                        <label class="form-label">{{ _(59) }}</label>
                        <input type="number" id="lessonsInput" class="form-control" name="lessons" value="8" min="1" max="30">
                    </div>
                    <div class="mb-3">
                        <label class="form-label">{{ _(60) }}</label>
                        <div class="d-flex gap-2 align-items-start">
                            <select id="weekdayPresetSelect" class="form-select" style="width:300px; display:inline-block;">
                                <option value="en-ltr" data-i18n="English ‚Äî LTR">English ‚Äî LTR</option>
                                <option value="en-rtl" data-i18n="English ‚Äî RTL">English ‚Äî RTL</option>
                                <option value="he-ltr" data-i18n="◊¢◊ë◊®◊ô◊™ ‚Äî LTR">◊¢◊ë◊®◊ô◊™ ‚Äî LTR</option>
                                <option value="he-rtl" data-i18n="◊¢◊ë◊®◊ô◊™ ‚Äî RTL">◊¢◊ë◊®◊ô◊™ ‚Äî RTL</option>
                                <option value="ru-ltr" data-i18n="–†—É—Å—Å–∫–∏–π ‚Äî LTR">–†—É—Å—Å–∫–∏–π ‚Äî LTR</option>
                                <option value="ru-rtl" data-i18n="–†—É—Å—Å–∫–∏–π ‚Äî RTL">–†—É—Å—Å–∫–∏–π ‚Äî RTL</option>
                            </select>
                            <input id="weekdaysInput" type="text" class="form-control" name="WEEKDAYS" value="{{ _('Monday') }},{{ _('Tuesday') }},{{ _('Wednesday') }},{{ _('Thursday') }},{{ _('Friday') }}">
                        </div>
                        <div class="form-text">{{ _('Choose a preset, then edit the comma-separated weekdays if needed') }}</div>
                    </div>
                </div>
            </div>
            
            <!-- Time Slots Editor Section -->
            <div class="row mt-4">
                <div class="col-md-12">
                    <h5>{{ _('Time Slots') }}</h5>
                    <div class="card">
                        <div class="card-body">
                            <div class="table-responsive" style="max-height: 400px; overflow-y: auto;">
                                <table class="table table-sm table-bordered" id="timeSlotsTable">
                                    <thead class="table-light">
                                        <tr>
                                            <th style="width: 80px;">{{ _('Lesson') }}</th>
                                            <th style="width: 250px;">{{ _('Time Range (click to edit)') }}</th>
                                            <th style="width: 80px;">{{ _('Delete') }}</th>
                                        </tr>
                                    </thead>
                                    <tbody id="timeSlotsBody">
                                        <!-- Populated by JavaScript -->
                                    </tbody>
                                </table>
                            </div>
                            
                            <!-- Add/Edit Time Slot Controls (outside form to prevent submit) -->
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Add New Time Slot (separate from main form) -->
            <div class="row mt-3">
                <div class="col-md-12">
                    <div class="card">
                        <div class="card-body">
                            <h6>{{ _('Add New Time Slot') }}</h6>
                            <div class="row">
                                <div class="col-md-3">
                                    <label class="form-label">{{ _('Lesson Number') }}</label>
                                    <input type="number" id="editLessonNum" class="form-control" min="1" max="30" value="1">
                                </div>
                                <div class="col-md-4">
                                    <label class="form-label">{{ _('Time Range') }}</label>
                                    <input type="text" id="editTimeRange" class="form-control" placeholder="9:15-10:00">
                                </div>
                                <div class="col-md-3 d-flex align-items-end">
                                    <button type="button" class="btn btn-success" id="addSlotBtn">{{ _('Add Slot') }}</button>
                                </div>
                            </div>
                            
                            <div class="alert alert-info mt-3 mb-0">
                                <small>
                                    <strong>üí° {{ _('Tips:') }}</strong>
                                    <ul class="mb-0">
                                        <li>{{ _('Click on any time range in the table to edit it inline') }}</li>
                                        <li>{{ _('Time format: H:MM-H:MM or HH:MM-HH:MM (e.g., 9:15-10:00 or 09:15-10:00)') }}</li>
                                        <li>{{ _('Press Enter to save, Escape to cancel inline editing') }}</li>
                                        <li>{{ _('Number of slots will auto-sync with "Number of lessons" setting') }}</li>
                                    </ul>
                                </small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <button type="submit" class="btn btn-primary mt-3">{{ _(26) }}</button>
        </form>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='js/schedule_grid.js') }}"></script>
<script>
$(document).ready(function() {
    loadTeachers();
    loadGroups();
    loadSubjects();
    loadConfiguration();
    
    // Tab change handlers
    $('#group-scheduler-tab').on('shown.bs.tab', function() {
        loadGroupScheduler();
    });
    
    $('#teacher-scheduler-tab').on('shown.bs.tab', function() {
        loadTeacherScheduler();
    });
    
    // Ensure Day Scheduler loads when its tab is shown
    $('#day-scheduler-tab').on('shown.bs.tab', function() {
        loadDayScheduler();
    });
});
</script>
{% endblock %}
